/*
 * HX711 Load Cell Sensor with ESP32
 * Converted for PlatformIO
 * 
 * Hardware Connections:
 * HX711 VCC -> ESP32 3.3V
 * HX711 GND -> ESP32 GND  
 * HX711 DT  -> ESP32 GPIO 5
 * HX711 SCK -> ESP32 GPIO 18
 */

#include <Arduino.h>
#include "HX711.h"

// Defines the connected PIN between HX711 and ESP32
#define LOADCELL_DOUT_PIN 5
#define LOADCELL_SCK_PIN  18

// Initialize the HX711 library as LOADCELL_HX711
HX711 LOADCELL_HX711;

void setup() {
  // Initialize serial communication
  Serial.begin(115200);
  Serial.println();
  delay(1000);
  
  Serial.println("Setup...");
  delay(1000);
  
  Serial.println();
  Serial.println("LOADCELL_HX711 begin.");
  LOADCELL_HX711.begin(LOADCELL_DOUT_PIN, LOADCELL_SCK_PIN);
  delay(1000);
  
  Serial.println();
  if (LOADCELL_HX711.is_ready()) {
    Serial.println("Do not place any object or weight on the scale.");
    Serial.println("Please wait...");
    for (byte i = 5; i > 0; i--) {
      Serial.println(i);
      delay(1000);
    }
    
    LOADCELL_HX711.set_scale();
    
    Serial.println();
    Serial.println("Set the scales...");
    Serial.println("Please wait...");
    delay(1000);
    
    LOADCELL_HX711.tare();  // Reset scale to 0
    Serial.println();
    Serial.println("Please place objects or weights on the scales.");
    for (byte i = 5; i > 0; i--) {
      Serial.println(i);
      delay(1000);
    }
  } else {
    Serial.println("HX711 not found.");
  }
  
  Serial.println();
  Serial.println("Setup finish.");
  delay(1000);
  
  Serial.println();
}

void loop() {
  if (LOADCELL_HX711.is_ready()) {
    // The value 10 in get_units(10) means getting the average value of 10 readings
    // For more details see HX711 library examples
    long reading = LOADCELL_HX711.get_units(10);
    Serial.print("Sensor reading results : ");
    Serial.println(reading);
  } else {
    Serial.println("HX711 not found.");
  }
  delay(1000);
}